# Alpaca Client Unit Test TODO

This document tracks the progress of creating unit tests for the Alpaca client files.

## Client Test Status

- [ ] `camera-client.ts`
- [ ] `covercalibrator-client.ts`
- [ ] `dome-client.ts`
- [ ] `filterwheel-client.ts`
- [ ] `focuser-client.ts`
- [ ] `observingconditions-client.ts`
- [ ] `rotator-client.ts`
- [ ] `safetymonitor-client.ts`
- [ ] `switch-client.ts`
- [ ] `telescope-client.ts`

## Notes & Patterns

- When testing methods that call `this.setProperty(propertyName, value)` (which results in a `PUT` request):
  - The parameter name in the request body is determined by `toParamFormat(propertyName)` from `base-client.ts`.
    - General tendency: camelCase or lowercase `propertyName` often becomes PascalCase (e.g., `cooleron` -> `Cooleron`).
    - **Specific Case Observations (examples from `camera-client`)**:
      - `toParamFormat('startx')` -> `StartX`
      - `toParamFormat('starty')` -> `StartY`
      - `toParamFormat('numx')` -> `Numx`
      - `toParamFormat('numy')` -> `Numy`
      - `toParamFormat('subexposureduration')` -> `SubExposureDuration` (note capitalization of internal words)
    - Tests must expect the _exact_ casing produced by `toParamFormat` for the specific `propertyName`. It's best to verify with a failing test first if unsure.
  - Example: `this.setProperty('cooleron', true)` will send `Cooleron=True`.
  - Example: `this.setProperty('startx', 10)` will send `StartX=10`.
  - Example: `this.setProperty('numx', 100)` will send `Numx=100`.
  - Example: `this.setProperty('subexposureduration', 0.5)` will send `SubExposureDuration=0.5`.
- For boolean values passed to `setProperty`, they are converted to string representations ("True" or "False") in the request body by `toAscomValue()`.
- **URLSearchParams Order**: The stringification of `URLSearchParams` (i.e., `URLSearchParams.toString()`) in the test environment appears to preserve the order in which parameters are defined in an object literal passed to the constructor, or the order they are appended. It does not strictly alphabetize them.
  - Client Code (`base-client.ts` for `PUT` from `setProperty` or multi-parameter `put`):
    - `requestBody` is often formed like `{ ...specificParams, ClientID: ... }` (where `specificParams` are those passed to `put` or generated by `setProperty`).
    - `Object.entries()` on this, then `append()` to `URLSearchParams` generally results in the `specificParams` appearing _before_ `ClientID` in the final stringified body (e.g., `ParamName1=value1&ParamName2=value2&ClientID=id`).
  - Test Code (`*.spec.ts`):
    - When constructing `expectedBody`, ensure the `URLSearchParams` is created from an object literal (or via `append` calls) in an order that matches this observed client behavior (specific params first, then `ClientID`).

(Add any notes, common patterns, or decisions made during testing here to help with subsequent tests.)
